<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Data Camp ? AI Mentor Chat</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="theme-light">
  <header class="nav">
    <div class="nav__inner">
      <div class="nav__brand">AI Data Camp</div>
      <nav aria-label="Main navigation">
        <ul class="nav__links">
          <li><a href="index.html#home" class="nav__link">Home</a></li>
          <li><a href="modules/index.html" class="nav__link">Learn Modules</a></li>
          <li><a href="ai-mentor.html" class="nav__link" aria-current="page">AI Mentor Chat</a></li>
          <li><a href="about.html" class="nav__link">About & Toolkit</a></li>
          <li><a href="sources.html" class="nav__link">Sources</a></li>
        </ul>
      </nav>
      <button class="btn btn--ghost nav__toggle" id="themeToggle" aria-label="Toggle light or dark mode">Light</button>
    </div>
  </header>

  <main>
    <section class="section section--hero intro" id="mentorIntro">
      <div class="intro__wrap card animate-on-scroll">
        <h1 class="hero__title">AI Mentor Chat</h1>
        <p class="hero__text">Chat with the AI mentor, read the replies, and pick the best response. See what AI misses and when you need to double-check.</p>
        <div class="pill pill--muted">7 scenarios + 1 final question</div>
        <div class="section__header">
          <h2>Quiz overview</h2>
          <p>Read each AI reply and choose the best response. You can try twice per question.</p>
        </div>
        <ul class="mentor-list">
          <li>7 scenarios + 1 final question</li>
          <li>Earn points for first-try answers</li>
          <li>Explanations after every question</li>
        </ul>
        <button class="btn btn--primary intro__start" id="startMentorQuiz">Start quiz</button>
      </div>
    </section>

    <section class="section app-hidden" id="chatSection">
      <div class="chat-shell">
        <div class="chat-shell__header">
          <div class="chat-shell__avatar" aria-hidden="true">&#129302;</div>
          <div class="chat-shell__info">
            <div class="chat-shell__name">AI Mentor</div>
            <div class="chat-shell__status" id="chatStatus">online</div>
          </div>
          <div class="chat-shell__meta" id="chatMeta">Scenario 1/7</div>
        </div>

        <div class="chat-window" id="chatWindow" aria-live="polite"></div>

        <div class="chat-footer">
          <div class="quick-replies" id="jumpControls" aria-label="Temporary jump controls">
            <select id="jumpSelect" class="quick-reply">
              <option value="0">Jump to: Scenario 1</option>
              <option value="1">Scenario 2</option>
              <option value="2">Scenario 3</option>
              <option value="3">Scenario 4</option>
              <option value="4">Scenario 5</option>
              <option value="5">Scenario 6</option>
              <option value="6">Scenario 7</option>
              <option value="final">Final question</option>
            </select>
            <button class="quick-reply" id="jumpBtn" type="button">Go</button>
          </div>
          <div class="chat-footer__prompt" id="chatPrompt">Choose an answer to check the AI.</div>
          <div class="quick-replies" id="optionsBox" role="listbox" aria-label="Answer options"></div>
          <button class="btn btn--primary chat-next" id="nextBtn" disabled>Next scenario</button>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    Made with curiosity for young AI explorers. Keep learning and stay kind online.
  </footer>

  <button id="backToTop" class="btn btn--circle" aria-label="Back to top"><svg width="40" height="24" viewBox="0 0 40 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 20L20 4L36 20" stroke="currentColor" stroke-width="8" stroke-linecap="round" stroke-linejoin="round"/></svg><span class="sr-only">Back to top</span></button>

  <div class="mascot" role="button" tabindex="0" aria-label="AI Data Camp helper" id="mascot">
    <div class="mascot__face">&#129302;</div>
    <div class="mascot__bubble" id="mascotBubble" aria-live="polite">Stay curious!</div>
  </div>

  <script src="script.js"></script>
  <script>
    (async () => {
      let chatData;
      try {
        const response = await fetch("quiz.json");
        if (!response.ok) throw new Error(`Failed to load quiz data: ${response.status}`);
        chatData = await response.json();
      } catch (error) {
        console.error("Failed to load quiz data", error);
        return;
      }

    const chatWindow = document.getElementById("chatWindow");

    const optionsBox = document.getElementById("optionsBox");
    const nextBtn = document.getElementById("nextBtn");
    const chatPrompt = document.getElementById("chatPrompt");
    const chatMeta = document.getElementById("chatMeta");
    const chatStatus = document.getElementById("chatStatus");
    const startMentorQuiz = document.getElementById("startMentorQuiz");
    const mentorIntro = document.getElementById("mentorIntro");
    const chatSection = document.getElementById("chatSection");
    const jumpSelect = document.getElementById("jumpSelect");
    const jumpBtn = document.getElementById("jumpBtn");

    const totalQuestions = chatData.module.scenarios.length + 1;
    let currentIndex = 0;
    let mode = "scenario"; // scenario | final | done
    let answered = false;
    let score = 0;
    let attempts = 0;

    const updateMeta = () => {
      if (mode === "scenario") {
        const topic = chatData.module.scenarios[currentIndex].topic;
        chatMeta.textContent = `${topic} ? Scenario ${currentIndex + 1}/${chatData.module.scenarios.length}`;
      } else if (mode === "final") {
        chatMeta.textContent = "Final question";
      } else {
        chatMeta.textContent = "Summary";
      }
    };

    const typeText = (el, text, speed = 18) => new Promise((resolve) => {
      let idx = 0;
      const tick = () => {
        if (idx >= text.length) {
          resolve();
          return;
        }
        el.textContent += text[idx];
        idx += 1;
        chatWindow.scrollTop = chatWindow.scrollHeight;
        setTimeout(tick, speed);
      };
      tick();
    });

    let typingQueue = Promise.resolve();

    const addMessage = (text, sender, meta) => {
      const wrap = document.createElement("div");
      wrap.className = `bubble bubble--${sender}`;
      if (meta) {
        const metaEl = document.createElement("div");
        metaEl.className = "bubble__meta";
        metaEl.textContent = meta;
        wrap.appendChild(metaEl);
      }
      const p = document.createElement("p");
      wrap.appendChild(p);
      chatWindow.appendChild(wrap);
      chatWindow.scrollTop = chatWindow.scrollHeight;
      if (sender === "bot") {
        typingQueue = typingQueue.then(() => typeText(p, text));
        return typingQueue;
      } else {
        p.textContent = text;
      }
    };

    const finalizeQuestion = (explanationText, correctOptionText, pointsEarned) => {
      answered = true;
      const scoreNote = pointsEarned ? ` (+${pointsEarned} point${pointsEarned === 1 ? "" : "s"})` : "";
      if (explanationText) addMessage(explanationText.trim(), "bot", "AI Mentor");
      if (scoreNote) addMessage(scoreNote.trim(), "bot", "AI Mentor");
      chatPrompt.textContent = "Answer processed. Click next.";
      if (mode === "scenario") {
        nextBtn.textContent = currentIndex === chatData.module.scenarios.length - 1
          ? "Go to final question"
          : "Next scenario";
      } else if (mode === "final") {
        nextBtn.textContent = "See results";
      }
      nextBtn.disabled = false;
    };

    const renderOptions = (options, correctAnswer, explanationText) => {
      optionsBox.innerHTML = "";
      attempts = 0;
      options.forEach((opt, idx) => {
        const btn = document.createElement("button");
        btn.className = "quick-reply";
        btn.type = "button";
        btn.textContent = opt;
        btn.addEventListener("click", () => {
          if (answered) return;
          attempts += 1;
          addMessage(opt, "user", "You");
          const isCorrect = idx === correctAnswer;

          if (isCorrect) {
            const pointsEarned = attempts === 1 ? 1 : 0.5;
            score += pointsEarned;
            const feedback = attempts === 1 ? "Correct! Sharp thinking." : "Nice! Got it on your second try.";
            addMessage(feedback, "bot", "AI Mentor");
            finalizeQuestion(explanationText, options[correctAnswer], pointsEarned);
            return;
          }

          // Wrong answer flow: allow a second try
          if (attempts === 1) {
            addMessage("Almost. Try again.", "bot", "AI Mentor");
            btn.disabled = true;
            btn.classList.add("is-disabled");
            return;
          }

          // Second wrong attempt: reveal and move on with no points
          const correctText = options[correctAnswer];
          addMessage(`Not quite. The correct answer is: "${correctText}".`, "bot", "AI Mentor");
          finalizeQuestion(explanationText, correctText, 0);
        });
        optionsBox.appendChild(btn);
      });
    };

    const showScenario = () => {
      const scenario = chatData.module.scenarios[currentIndex];
      answered = false;
      attempts = 0;
      nextBtn.disabled = true;
      nextBtn.textContent = "Next scenario";
      chatPrompt.textContent = "Read the AI reply and choose your response.";
      chatWindow.innerHTML = "";
      updateMeta();
      chatStatus.textContent = "typing...";

      addMessage(scenario.question, "user", `You ? ${scenario.topic}`);
      setTimeout(() => {
        addMessage(scenario.ai_answer, "bot", "AI Mentor");
      }, 350);
      setTimeout(() => {
        chatStatus.textContent = "online";
        addMessage(scenario.reflection.question, "bot", "AI Mentor ? Check");
        renderOptions(
          scenario.reflection.options,
          scenario.reflection.correct_answer,
          scenario.explanation
        );
      }, 700);
    };

    const showFinalQuestion = () => {
      mode = "final";
      answered = false;
      attempts = 0;
      nextBtn.disabled = true;
      chatWindow.innerHTML = "";
      chatPrompt.textContent = "Final question: choose the best way to use AI.";
      updateMeta();
      chatStatus.textContent = "typing...";

      const finalQ = chatData.module.final_question;
      addMessage("Last round! What is the best way to use AI?", "bot", "AI Mentor");
      setTimeout(() => {
        chatStatus.textContent = "online";
        addMessage(finalQ.question, "bot", "AI Mentor ? Final question");
        renderOptions(finalQ.options, finalQ.correct_answer, "AI is a helper, not the decision-maker.");
      }, 500);
    };

    const showSummary = () => {
      mode = "done";
      chatWindow.innerHTML = "";
      optionsBox.innerHTML = "";
      chatStatus.textContent = "online";
      chatPrompt.textContent = "Finished! Want to play again?";
      updateMeta();
      const resultText = `Score: ${score}/${totalQuestions}.`;
      const tip = score === totalQuestions
        ? "Great! You are checking AI critically."
        : score >= totalQuestions - 2
          ? "Nice work. Keep checking sources."
          : "Keep practicing: always ask for evidence and context.";
      addMessage("Well done, that was all the questions.", "bot", "AI Mentor");
      addMessage(`${resultText} ${tip}`, "bot", "AI Mentor");
      nextBtn.textContent = "Play again";
      nextBtn.disabled = false;
    };

    nextBtn.addEventListener("click", () => {
      if (mode === "done") {
        currentIndex = 0;
        score = 0;
        mode = "scenario";
        showScenario();
        return;
      }

      if (mode === "scenario") {
        currentIndex += 1;
        if (currentIndex >= chatData.module.scenarios.length) {
          showFinalQuestion();
        } else {
          showScenario();
        }
        return;
      }

      if (mode === "final") {
        showSummary();
      }
    });

    const jumpTo = (target) => {
      optionsBox.innerHTML = "";
      answered = false;
      attempts = 0;
      if (target === "final") {
        currentIndex = chatData.module.scenarios.length;
        showFinalQuestion();
        return;
      }
      const idx = Number(target);
      if (Number.isNaN(idx)) return;
      currentIndex = Math.max(0, Math.min(idx, chatData.module.scenarios.length - 1));
      mode = "scenario";
      showScenario();
    };

    if (jumpSelect && jumpBtn) {
      jumpBtn.addEventListener("click", () => jumpTo(jumpSelect.value));
    }

    if (startMentorQuiz && mentorIntro && chatSection) {
      startMentorQuiz.addEventListener("click", () => {
        mentorIntro.classList.add("app-hidden");
        chatSection.classList.remove("app-hidden");
        showScenario();
        chatSection.scrollIntoView({ behavior: "smooth", block: "start" });
      });
    } else {
      showScenario();
    }
    })();
  </script>
</body>
</html>




